{"version":3,"file":"codeLoader.min.modern.js","sources":["../src/db.js","../src/sha256.js","../src/data.js","../src/starterNoFramerMotion.js","../src/transpile.js","../src/ipfsKV.js","../src/share.js","../src/codeLoader.js","../src/DraggableWindow.js"],"sourcesContent":["import { getDB } from \"https://unpkg.com/@zedvision/shadb@8.7.2/dist/shaDB.js\";\n\nlet db;\n\nexport const shaDB = {\n  get: async (...args) => {\n    db = db || await getDB();\n    return db.get(...args);\n  },\n  put: async (...args) => {\n    db = db || await getDB();\n    return db.put(...args);\n  },\n};\n","export const sha256 = async (x) =>\n  Array.from(\n    new Uint8Array(\n      await crypto.subtle.digest(\n        \"SHA-256\",\n        typeof x === \"string\" ? new TextEncoder().encode(x) : x,\n      ),\n    ).slice(0, 4),\n  ).map((b) => (\"00\" + b.toString(16)).slice(-2)).join(\"\");\n","import { shaDB } from \"./db.js\";\nimport v4 from \"https://unpkg.com/uuid@8.3.2/dist/esm-browser/v4.js\";\nimport { sha256 } from \"./sha256.js\";\n\nexport async function getZkey(hash) {\n  const uuid = await getUserId();\n  const uKey = await sha256(uuid);\n  const gKey = await sha256(hash + uKey);\n  const vKey = await sha256(hash + uuid);\n  return `${hash}${uKey}${gKey}${vKey}`;\n}\n\nexport async function getUserId() {\n  const uuid = await shaDB.get(\"uuid\");\n  if (!uuid) {\n    const resp = await fetch(\"https://code.zed.vision/register\");\n    const data = await resp.json();\n    await shaDB.put(\"uuid\", data.uuid);\n    return data.uuid;\n  }\n  return uuid;\n}\n\nexport const getProjects = async () => {\n  const uuid = await getUserId();\n  const projects = await shaDB.get(uuid, \"json\");\n\n  if (typeof projects === \"string\" || projects === null || !projects.list) {\n    const projectId = v4();\n\n    await shaDB.put(\n      uuid,\n      JSON.stringify({\n        list: [projectId],\n        [projectId]: {\n          created: Date.now(),\n          lastOpen: Date.now(),\n        },\n      }),\n    );\n\n    return [projectId];\n  }\n\n  // const search = new URLSearchParams(window.location.search);\n\n  // const keyToLoad = search.get(\"h\") || await db.get(projectName);\n  // if(keyToLoad){\n  //   projects.map(p=>shaDB.get())\n  // }\n\n  return projects.list;\n};\n\nexport const saveCode = async (code) => {\n  const hash = await sha256(code);\n\n  const projects = await getProjects();\n  const projectName = projects[0];\n\n  try {\n    const prevHash = await shaDB.get(projectName);\n\n    if (prevHash !== hash) {\n      await shaDB.put(hash, code);\n      await shaDB.put(projectName, hash);\n      // setQueryStringParameter(\"h\", hash);\n      //const response = fetch(request);\n    }\n  } catch (e) {\n    console.error(e);\n  }\n\n  // lets not save now - we will save the diff only\n  // await response;\n};\n","export const starter = `import { useState } from \"react\";\nimport { css, Global } from \"@emotion/react\";\n\nconst Slider = () => {\n  const steps = 128;\n  const [sliderValue, setSlider] = useState(steps / 2);\n  return <>\n    <input max={steps}\n      css={\\`\n        appearance: none;\n        width: 100%;\n        height: 40px; \n        background: rgb(\\${255 / steps * sliderValue} \\${255 / steps * (steps - sliderValue)} 0); \n        outline: none; \n    \\`} type=\"range\"\n      aria-label=\"font size changer\"\n      value={sliderValue}\n      step=\"1\"\n      onChangeCapture={(e) => setSlider(Number(e.currentTarget.value))}>\n    </input>\n    <p\n      css={css\\`\n        font-size: \\${72 / steps * sliderValue}px\n        \\`}>\n      Example when the text gets bigger...\n    </p>\n    <p css={css\\`\n        font-size: \\${72 / steps * (steps - sliderValue)}px\n        \\`}>\n      ...or smaller\n    </p>\n  </>\n}\n\nexport default () => <>\n  <Global styles={css\\`\n      body{\n          margin: 0;\n          overflow: overlay;\n        }  \n    \\`} />\n  <Slider />\n</>\n`;\n","import * as Comlink from \"https://unpkg.com/comlink/dist/esm/comlink.mjs\";\nimport { shaDB } from \"./db.js\";\n// import * as Comlink from \"../../../dist/esm/comlink.mjs\";\n\nlet transform;\nexport async function transpileCode(code, hasToReport) {\n  transform = transform || await init();\n\n  return await transform(code, hasToReport);\n}\n\nlet node = null;\n\nexport async function getIpfsiD() {\n  if (node) return node;\n\n  let ipfsId = await shaDB.get(\"ipfs\");\n  if (!ipfsId) {\n    ipfsId = v4();\n\n    await shaDB.put(\"ipfs\", ipfsId);\n  }\n\n  return ipfsId;\n}\n\nlet ipfsNode;\nexport async function ipfsAdd(code, hasToReport) {\n  ipfsNode = ipfsNode || await Ipfs.create({ repo: await getIpfsiD() });\n\n  return await transform(code, hasToReport);\n}\n\nfunction init() {\n  const worker = new Worker(\n    \"./src/transpile.worker.js\",\n  );\n  // WebWorkers use `postMessage` and therefore work with Comlink.\n  transform = Comlink.wrap(worker);\n  return transform;\n}\ninit();\n","import * as Comlink from \"https://unpkg.com/comlink/dist/esm/comlink.mjs\";\n// import * as Comlink from \"../../../dist/esm/comlink.mjs\";\n\nlet ipfsWorker;\n\nexport const ipfsKV = {\n  add: async (data) => (ipfsWorker || await initIpfsKV()).add(data),\n};\n\nfunction initIpfsKV() {\n  const worker = new Worker(\n    \"./src/ipfsKV.worker.js\",\n  );\n\n  ipfsWorker = Comlink.wrap(worker);\n  return ipfsWorker;\n}\ninitIpfsKV();\n","import { importScript } from \"./importScript.js\";\nimport { sha256 } from \"./sha256.js\";\nimport { getZkey } from \"./data.js\";\nimport { ipfsKV } from \"./ipfsKV.js\";\n\nexport const shareItAsHtml = async ({ code, HTML, jsExport }) => {\n  const mod = createJsBlob(code);\n\n  const Element = (await import(mod)).default;\n\n  const css = Array.from(\n    window.document.querySelector(\"head > style[data-emotion=css]\").sheet\n      .cssRules,\n  ).map((x) => x.cssText).filter((cssRule) =>\n    HTML.includes(cssRule.substring(3, 8))\n  ).join(\"\\n  \");\n\n  const { getHtml, getCodeForImport } = await import(\"./templates.js\");\n\n  const linkToCode = await saveToIPFS(code, \"application/html\");\n\n  console.log({\n    HTML,\n    linkToCode,\n    css,\n    code,\n  });\n\n  const link = await saveHtml(\n    getHtml({ HTML, css, js: getCodeForImport(linkToCode) }),\n  );\n\n  return link;\n};\n\nfunction saveHtml(html) {\n  return saveToIPFS(html, \"text/html\");\n}\n\nfunction saveJs(js) {\n  return save(js, \"application/javascript\");\n}\nasync function saveToIPFS(content, type) {\n  const cid = await ipfsKV.add(\n    URL.createObjectURL(new Blob([content], { type })),\n  );\n  return `https://ipfs.io/ipfs/${cid}`;\n}\n\nasync function save(content, type) {\n  const hash = await sha256(content);\n  const request = new Request(\n    \"https://code.zed.vision\",\n    {\n      body: content,\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": type + \";charset=UTF-8\",\n        \"ZKEY\": await getZkey(hash),\n      },\n    },\n  );\n\n  await fetch(request);\n\n  return `https://code.zed.vision/${hash}`;\n}\n\nexport function createJsBlob(code) {\n  const blob = new Blob([code], { type: \"application/javascript\" });\n\n  return URL.createObjectURL(blob);\n}\n","import startMonaco from \"https://unpkg.com/@zedvision/smart-monaco-editor@10.11.4/dist/smart-monaco-editor.modern.js\";\nimport { diff } from \"https://unpkg.com/@zedvision/diff@8.6.10/dist/diff.min.js\";\n\nimport prettier from \"https://unpkg.com/prettier@2.2.1/esm/standalone.mjs\";\nimport parserBabel from \"https://unpkg.com/prettier@2.2.1/esm/parser-babel.mjs\";\nimport parserHtml from \"https://unpkg.com/prettier@2.2.1/esm/parser-html.mjs\";\nimport renderDraggableWindow from \"./DraggableWindow.js\";\n\nimport { getProjects, saveCode } from \"./data.js\";\nimport { shaDB } from \"./db.js\";\nimport { starter } from \"./starterNoFramerMotion.js\";\nimport { transpileCode } from \"./transpile.js\";\nimport { createJsBlob, shareItAsHtml } from \"./share.js\";\n\nconst session = {\n  hydrated: false,\n  preRendered: false,\n  lastErrors: 0,\n  HTML: \"\",\n  ipfs: 0,\n  transpiled: \"\",\n  code: \"\",\n};\n\nfunction formatter(code) {\n  try {\n    return prettier.format(code, {\n      \"arrowParens\": \"always\",\n      \"bracketSpacing\": true,\n      \"embeddedLanguageFormatting\": \"auto\",\n      \"htmlWhitespaceSensitivity\": \"css\",\n      \"insertPragma\": false,\n      \"jsxBracketSameLine\": true,\n      \"jsxSingleQuote\": false,\n      \"printWidth\": 80,\n      \"proseWrap\": \"preserve\",\n      \"quoteProps\": \"as-needed\",\n      \"requirePragma\": false,\n      \"semi\": true,\n      \"singleQuote\": true,\n      \"tabWidth\": 2,\n      \"trailingComma\": \"all\",\n      \"useTabs\": false,\n      parser: \"babel-ts\",\n      plugins: [parserBabel, parserHtml],\n    });\n  } catch {\n    return code;\n  }\n}\n\nexport async function run(mode = \"window\", { React, ReactDOM }) {\n  console.log(\"Runnnner\");\n  session.code = formatter(await getCodeToLoad());\n  session.transpiled = await transpileCode(session.code);\n\n  if (mode === \"editor\") {\n    const { renderDraggableEditor } = await import(\"./DraggableEditor.js\");\n\n    await renderDraggableEditor();\n  }\n\n  if (mode === \"window\") {\n    const onShare = async () => {\n      const link = await shareItAsHtml(\n        { code: session.transpiled, HTML: session.HTML },\n      );\n      window.open(link);\n    };\n\n    await renderDraggableWindow({ ReactDOM, React, onShare });\n  }\n\n  const transpiled = await transpileCode(session.code);\n  restartCode(transpiled);\n\n  const modules = await startMonaco({\n    language: \"typescript\",\n    code: formatter(session.code),\n    onChange: (c) => runner(formatter(c)),\n  });\n\n  async function runner(cd) {\n    try {\n      const transpiled = await transpileCode(cd, session.lastErrors);\n      if (session.transpiled === transpiled) return;\n      let restartError = false;\n      ///yellow\n      if (transpiled.length && session.lastErrors === 0) {\n        restartError = restartCode(transpiled);\n      }\n\n      const err = [\n        ...(restartError\n          ? [\n            { messageText: \"Error while starting the app. Check the console!\" },\n          ]\n          : []),\n        ...(await getErrors(cd)),\n      ];\n      if (session.lastErrors && err.length === 0) restartCode(transpiled);\n      session.lastErrors = err.length;\n      const errorDiv = window.document.getElementById(\"error\");\n      if (err.length === 0 && transpiled.length) {\n        session.code = cd;\n        if (session.transpiled !== transpiled) {\n          session.transpiled = transpiled;\n\n          await saveCode(formatter(cd), session.transpiled);\n        }\n\n        await saveCode(cd);\n      } else {\n        session.error = cd;\n\n        const slices = await diff(session.code, cd);\n\n        if (slices.c.length <= 3) {\n          session.lastErrors = 0;\n\n          return;\n        }\n\n        if (slices.c.length == 4) {\n          session.lastErrors = 0;\n          modules.monaco.editor.setTheme(\"hc-black\");\n\n          return;\n        }\n\n        errorDiv.innerHTML = err[0].messageText.toString();\n\n        errorDiv.style.display = \"block\";\n\n        return;\n      }\n\n      errorDiv.style.display = \"none\";\n\n      modules.monaco.editor.setTheme(\"vs-dark\");\n    } catch (err) {\n      modules.monaco.editor.setTheme(\"vs-light\");\n      setTimeout(() => {\n        modules.monaco.editor.setTheme(\"hc-black\");\n      }, 50);\n      console.error(err);\n    }\n  }\n\n  async function getErrors(code) {\n    if (!modules || !modules.monaco) return;\n    const { monaco } = modules;\n    const { sha256 } = await import(\"./sha256.js\");\n    const shaCode = await sha256(code);\n    const filename = `file:///${shaCode}.tsx`;\n    const uri = monaco.Uri.parse(filename);\n    const model = monaco.editor.getModel(uri) ||\n      await monaco.editor.createModel(code, \"typescript\", uri);\n    const worker = await monaco.languages.typescript.getTypeScriptWorker();\n    const client = await worker(model.uri);\n\n    const diag = client.getSemanticDiagnostics(filename);\n    const comp = client.getCompilerOptionsDiagnostics(filename);\n    const syntax = client.getSyntacticDiagnostics(filename);\n    const fastError = await Promise.race([diag, comp, syntax]);\n\n    model.dispose();\n\n    return [\n      ...fastError,\n    ];\n  }\n\n  async function restartCode(transpiled) {\n    if (typeof transpiled !== \"string\" || transpiled === \"\") {\n      // console.log(transpiled.error);\n      return 1;\n    }\n\n    const codeToHydrate = mode === \"window\"\n      ? transpiled.replace(\"body{\", \"#zbody{\")\n      : transpiled;\n\n    const root = window.document.createElement(\"div\");\n    \n\n      \n    const Element = (await import(createJsBlob(codeToHydrate))).default;\n\n\n    ReactDOM.render(Element(), root);\n\n    document.getElementById(\"zbody\").removeChild()\n    document.getElementById(\"zbody\").appendChild(root);\n\n    session.HTML = root.innerHTML;\n\n\n    return !session.preRendered;\n  }\n\n  async function getCodeToLoad() {\n    const projects = await getProjects();\n    const projectName = projects[0];\n\n    const search = new URLSearchParams(window.location.search);\n    const keyToLoad = search.get(\"h\") || await shaDB.get(projectName);\n\n    if (keyToLoad) {\n      let code;\n      try {\n        code = await shaDB.get(keyToLoad);\n      } catch {\n        console.error(\"error load key: \" + keyToLoad);\n      }\n\n      if (code) return code;\n\n      let text;\n      try {\n        const resp = await fetch(\"https://code.zed.vision/?h=\" + keyToLoad);\n        text = await resp.json();\n      } catch (e) {\n        const { sha256 } = await import(\"./sha256.js\");\n        const shaHash = await sha256(starter);\n\n        shaDB.put(shaHash, starter);\n        await shaDB.put(projectName, shaHash);\n        return starter;\n      }\n\n      return text;\n    }\n\n    return starter;\n  }\n\n  function setQueryStringParameter(name, value) {\n    const params = new URLSearchParams(window.location.search);\n    params.set(name, value);\n    window.history.replaceState(\n      {},\n      \"\",\n      decodeURIComponent(`${window.location.pathname}?${params}`),\n    );\n  }\n}\n","\n\nexport default async ({ ReactDOM, onShare }) => {\n const { css, jsx } = await import( \"https://cdn.skypack.dev/@emotion/react@11.1.4\");\n\n  ReactDOM.render(\n    jsx(DraggableWindow, {\n      onShare,\n    }),\n    window.document.getElementById(\"dragabbleWindow\"),\n  );\n\n  function DraggableWindow({ onShare }) {\n    return jsx(\n      \"div\",\n      null,\n      jsx(\n        \"div\",\n        {\n          css: css`\n            background: red;\n            border: 4px solid red;\n            border-radius: 8px;\n          `,\n          animate: {\n            scale: 1,\n            top: 1,\n            left: 600,\n          },\n          dragElastic: 0.5,\n          dragMomentum: false,\n          initial: {\n            top: 1,\n            left: 0,\n            scale: 0.7,\n          },\n          transition: {\n            duration: 0.5,\n          },\n          drag: true,\n          dragConstraints: {\n            left: -window.innerWidth + 200,\n            right: 0,\n            bottom: window.innerHeight - 200,\n            top: 0,\n          },\n        },\n        jsx(\n          \"div\",\n          {\n            css: `\n      display: block;\n      with: 100%;\n      text-align: right;\n      background: linear-gradient(0deg, darkred, red);\n    `,\n          },\n          jsx(\"button\", {\n            css: `\n              background: darkred;\n              margin-top: -4px;\n              margin-right: -4px;\n              color: white;\n              cursor: pointer;\n              font-weight: bold;\n              font-family: Roboto;\n              padding: 8px 16px;\n              outline: none;\n              border: none;\n              border-radius: 0px 8px 0px 0px;\n            `,\n            onClick: () => onShare(),\n          }, \"ðŸŒŽ SHARE\"),\n        ),\n        jsx(\"div\", {\n          css: `\n      min-width: 200px;\n      padding: 30px;\n      max-width: 600px;\n      background: white;\n      max-height: 800px;\n      border-radius: 0px 0px 8px 8px;\n      overflow-y: overlay;\n    `,\n          id: \"zbody\",\n        }),\n      ),\n      null,\n    );\n  }\n};\n"],"names":["db","shaDB","async","args","getDB","get","put","sha256","x","Array","from","Uint8Array","crypto","subtle","digest","TextEncoder","encode","slice","map","b","toString","join","getProjects","uuid","resp","fetch","data","json","getUserId","projects","list","projectId","v4","JSON","stringify","[object Object]","created","Date","now","lastOpen","saveCode","hash","code","projectName","e","console","error","starter","transform","ipfsWorker","transpileCode","hasToReport","init","worker","Worker","Comlink","initIpfsKV","saveToIPFS","content","type","add","ipfsKV","URL","createObjectURL","Blob","createJsBlob","blob","session","hydrated","preRendered","lastErrors","HTML","ipfs","transpiled","formatter","prettier","format","arrowParens","bracketSpacing","embeddedLanguageFormatting","htmlWhitespaceSensitivity","insertPragma","jsxBracketSameLine","jsxSingleQuote","printWidth","proseWrap","quoteProps","requirePragma","semi","singleQuote","tabWidth","trailingComma","useTabs","parser","plugins","parserBabel","parserHtml","run","mode","React","ReactDOM","log","keyToLoad","URLSearchParams","window","location","search","text","shaHash","getCodeToLoad","renderDraggableEditor","onShare","link","mod","css","document","querySelector","sheet","cssRules","cssText","filter","cssRule","includes","substring","getHtml","getCodeForImport","linkToCode","html","js","shareItAsHtml","open","jsx","render","animate","scale","top","left","dragElastic","dragMomentum","initial","transition","duration","drag","dragConstraints","innerWidth","right","bottom","innerHeight","onClick","id","getElementById","renderDraggableWindow","restartCode","modules","startMonaco","language","onChange","c","cd","restartError","length","err","messageText","getErrors","errorDiv","slices","diff","monaco","editor","setTheme","innerHTML","style","display","setTimeout","runner","filename","uri","Uri","parse","model","getModel","createModel","languages","typescript","getTypeScriptWorker","client","diag","getSemanticDiagnostics","comp","getCompilerOptionsDiagnostics","syntax","getSyntacticDiagnostics","fastError","Promise","race","dispose","codeToHydrate","replace","root","createElement","Element","default","removeChild","appendChild"],"mappings":"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"}